schema: '2.0'
stages:
  setup:
    cmd: python -m export
    deps:
    - path: export.py
      hash: md5
      md5: e5501f118c33fbcb0385d7705b908787
      size: 4831
    - path: model.py
      hash: md5
      md5: 896fe02e3d22eb76b10d8f33547db4da
      size: 27040
    params:
      params.yaml:
        calibration_passes: 32
        export:
          opset_version: 14
          do_constant_folding: true
        model:
          num_heads: 12
          num_layers: 1
          bias: true
          emb_dim: 384
          mlp_dim: 1536
          seq_len: 512
          bits: 2
          norm: none
          mask: none
          positional_encoding: binary
        seed: 12
    outs:
    - path: outputs/inp.npy
      hash: md5
      md5: faa284b49c027e97e777d0813952b34d
      size: 786560
    - path: outputs/model.onnx
      hash: md5
      md5: 7ae4ea998a3a618dabbaa4d555d6cd51
      size: 7903126
    - path: outputs/out.npy
      hash: md5
      md5: e73cfbfc6feee336899930224c5f074e
      size: 786560
  build:
    cmd: bash run.sh '$FINN/run-docker.sh build_custom $(pwd)'
    deps:
    - path: build.py
      hash: md5
      md5: b10586b20cb94662b318bff0431d74c7
      size: 6905
    - path: build_steps.py
      hash: md5
      md5: 4025dcf779731c43d34e314aa9f3431f
      size: 33401
    - path: custom/apply_config.py
      hash: md5
      md5: 4c907c16f9d3e2f5377e36f153af40b8
      size: 2360
    - path: noctua.sh
      hash: md5
      md5: f3e8cc342b63cddcd2e07bfe63f6518c
      size: 1832
    - path: outputs/inp.npy
      hash: md5
      md5: faa284b49c027e97e777d0813952b34d
      size: 786560
    - path: outputs/model.onnx
      hash: md5
      md5: 7ae4ea998a3a618dabbaa4d555d6cd51
      size: 7903126
    - path: outputs/out.npy
      hash: md5
      md5: e73cfbfc6feee336899930224c5f074e
      size: 786560
    - path: run.sh
      hash: md5
      md5: 6e3e34149c16795c5a8424a51bdbf5f8
      size: 1616
    params:
      params.yaml:
        build:
          output_dir: outputs/build
          stitched_ip_gen_dcp: false
          synth_clk_period_ns: 10.0
          board: RFSoC2x2
          shell_flow_type: vivado_zynq
          folding_config_file: folding.yaml
          specialize_layers_config_file: specialize_layers.json
          standalone_thresholds: true
          max_multithreshold_bit_width: 16
          mvau_wwidth_max: 2048
          split_large_fifos: true
        model.emb_dim: 384
        model.seq_len: 512
        seed: 12
      folding.yaml:
        defaults:
          ScaledDotProductAttention_hls:
            ram_style: block
            ram_style_thresholds: block
            ram_style_mask: block
            mac_resource: lut
          ElementwiseAdd_hls:
            ram_style: distributed
          MVAU_hls:
            resType: dsp
            mem_mode: internal_decoupled
            ram_style: block
            ram_style_thresholds: block
            runtime_writeable_weights: 0
          MVAU_rtl:
            resType: dsp
            mem_mode: internal_decoupled
            ram_style: block
            runtime_writeable_weights: 0
          Thresholding_hls:
            mem_mode: internal_decoupled
            ram_style: distributed
            runtime_writeable_weights: 0
          Thresholding_rtl:
            depth_trigger_uram: 2147483647
            depth_trigger_bram: 2147483647
            runtime_writeable_weights: 0
          StreamingFIFO_rtl:
            impl_style: rtl
            ram_style: distributed
      specialize_layers.json:
        '':
          preferred_impl_style: ''
        Defaults:
          preferred_impl_style:
          - rtl
          - - MVAU
            - Thresholding
    outs:
    - path: outputs/build/
      hash: md5
      md5: 11007c7708cee830bd8a2a350790e158.dir
      size: 931089705
      nfiles: 2258
  metrics:
    cmd: python -m metrics
    deps:
    - path: metrics.py
      hash: md5
      md5: 027dcb70a77c34f84948bc3d5ee2107f
      size: 932
    - path: outputs/build/
      hash: md5
      md5: 11007c7708cee830bd8a2a350790e158.dir
      size: 931089705
      nfiles: 2258
    - path: outputs/build/report/post_synth_resources.json
      hash: md5
      md5: 4787083fe1a1bad9c11bb7bb6e9b2337
      size: 28503
    params:
      params.yaml:
        build.output_dir: outputs/build
        metrics:
          report: outputs/build/report/post_synth_resources.json
          filter: (top)
    outs:
    - path: metrics.yaml
      hash: md5
      md5: 4e59ad2eb18dc7ccce54bd9c8725e493
      size: 80
  folding:
    cmd: python -m make_folding
    deps:
    - path: make_folding.py
      hash: md5
      md5: 109abe8be2208a83b6a75402a7724a55
      size: 1282
    params:
      params.yaml:
        build:
          output_dir: build
          stitched_ip_gen_dcp: false
          synth_clk_period_ns: 10.0
          board: RFSoC2x2
          shell_flow_type: vivado_zynq
          folding_config_file: folding.json
          specialize_layers_config_file: specialize_layers.json
          standalone_thresholds: true
        model:
          num_heads: 1
          num_layers: 1
          bias: true
          emb_dim: 8
          mlp_dim: 32
          seq_len: 32
          bits: 4
          norm: none
          mask: none
          positional_encoding: binary
    outs:
    - path: folding.json
      hash: md5
      md5: 06ee08cf2900925414fe100e2f3cdb80
      size: 105
  verify:
    cmd: python -m verify
    deps:
    - path: outputs/build/verification_output/
      hash: md5
      md5: 3cda59f8fb9a0c896de3c1a9c966012f.dir
      size: 607836844
      nfiles: 6
    - path: verify.py
      hash: md5
      md5: 2cbebda1e941ed0be91b40ea513c8b8d
      size: 971
    params:
      params.yaml:
        build.output_dir: outputs/build
    outs:
    - path: verification.yaml
      hash: md5
      md5: 5224a3f087dfdd2bec5b236e4205ac3c
      size: 22
